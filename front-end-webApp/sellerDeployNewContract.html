<!DOCTYPE html>
<html>
    <title>BlockBazaar Seller Deploy Contract</title>

<head>
        <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D4JSQQJSYH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-D4JSQQJSYH');
  </script>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/logo_no_text.png">
  
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="background.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap CSS -->

    <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/vendor/font-awesome.css">
    <link rel="stylesheet" href="assets/css/vendor/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/vendor/slick.css">
    <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
    <link rel="stylesheet" href="assets/css/vendor/jquery-ui.min.css">
    <link rel="stylesheet" href="assets/css/vendor/sal.css">
    <link rel="stylesheet" href="assets/css/vendor/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/vendor/base.css">
    <link rel="stylesheet" href="assets/css/style.min.css">

    <style>
		body {
			background-color: #1e1e1e;
			color: #fff;
			font-family: 'Roboto', sans-serif;
			font-size: 16px;
		}
		h1 {
			font-size: 36px;
			font-weight: bold;
			color: #fff;
			text-align: center;
			margin-top: 50px;
			margin-bottom: 30px;
		}
		#readArea {
			margin: 0 auto;
			max-width: 800px;
			text-align: center;
		}
		button {
			background-color: #007bff;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
			font-weight: bold;
			margin-bottom: 20px;
			padding: 10px 30px;
            box-shadow: 0 0.5rem #0069e0;
			transition: background-color 0.3s ease-in-out;
            width: 50%;
		}

        p {
            color:#fff; 
        }

		button:hover {
			transform: translateY(-2px);
            box-shadow: 0 0.8rem #0069e0;
		}

        ::placeholder {
            color: rgb(240, 238, 235);
            text-align: center;
        }

		.cool-input {
			background-color: transparent;
			border: none;
			border-bottom: 2px solid #fff;
			color: #0f0f0f;
			font-size: 18px;
            text-align: center;
			margin-bottom: 20px;
			padding: 10px;
			width: 50%;
		}
		#cost, #deployValueText {
			font-size: 24px;
			font-weight: bold;
            text-align: center;
			margin-top: 30px;
		}
		#deployValue {
			background-color: #ecb44f;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
            
			font-weight: bold;
			margin-top: 20px;
			padding: 10px 30px;
			transition: background-color 0.3s ease-in-out;
		}
		#deployValue:hover {
			background-color: #c99134;
		}
		#deployContract, #addItem {
			background-color: #19d852;
			border: none;
			border-radius: 5px;
			color: #fff;
			cursor: pointer;
			font-size: 18px;
			font-weight: bold;
			margin-top: 20px;
			padding: 10px 30px;
			transition: background-color 0.3s ease-in-out;
		}
		#deployContract:hover, #addItem:hover {
			background-color: #149c0f;
		}
		#myProgress {
			background-color: #ddd;
			border-radius: 5px;
			height: 40px;
			margin-top: 20px;
			overflow: hidden;
			width: 100%;
            opacity: 0;
		}
		#myBar {
			background-color: #51e7ec;
			height: 40px;
			line-height: 40px;
			text-align: center;
			transition: width 0.3s ease-in-out;
			width: 0%;
            opacity: 0;
		}
		#contractWaitingArea {
			margin-top: 20px;
		}
		#contractDeployStateArea {
			margin-top: 20px;
		}
		#toContractDetail {
			margin-top: 20px;
		}
	</style>
</head>
<body class="sticky-header">
    <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
<![endif]-->
    <a href="#top" class="back-to-top" id="backto-top"><i class="fal fa-arrow-up"></i></a>
    <!-- Start Header -->
    <header class="header axil-header header-style-5">
        
        <!-- Start Mainmenu Area  -->
        <div id="axil-sticky-placeholder"></div>
        <div class="axil-mainmenu">
            <div class="container">
                <div class="header-navbar">
                    <div class="header-brand">

                        <!-- will include our logo below when ready -->
                        <!-- <a href="index.html" class="logo logo-dark">
                            <img src="assets/images/logo/logo.png" alt="Site Logo">
                        </a>
                        <a href="index.html" class="logo logo-light">
                            <img src="assets/images/logo/logo-light.png" alt="Site Logo">
                        </a> -->


                    </div>
                    <div class="header-main-nav">
                        <!-- Start Mainmanu Nav -->
                        <!-- <nav class="mainmenu-nav">
                            <button class="mobile-close-btn mobile-nav-toggler"><i class="fas fa-times"></i></button>
                            <div class="mobile-nav-brand">
                                <a href="index.html" class="logo">
                                    <img src="assets/images/logo/logo.png" alt="Site Logo">
                                </a>
                            </div>
                            <ul class="mainmenu">
                            </ul>
                        </nav> -->
                        <!-- End Mainmanu Nav -->
                    </div>
                    <div class="header-action">
                        <ul class="action-list">
                            <li class="my-account">
                                <a href="javascript:void(0)" >
                                    <i class="flaticon-person" style="color:rgb(244, 245, 242)"></i>
                                </a>
                                <div class="my-account-dropdown">
                                    <span class="title">QUICKLINKS</span>
                                    <ul>
                                        <!-- <li>
                                            <a href="my-account.html">My Account</a>
                                        </li> -->
                                        <li>
                                            <a href="homePage.html">Home</a>
                                        </li>
                                        <li>
                                          <a href="marketplace.html">Shop the Marketplace</a>
                                        </li>
                                        <li>
                                            <a href="sellerActiveContracts.html">My Active Contracts as Seller</a>
                                        </li>
                                        <li>
                                            <a href="buyerActiveContract.html">My Active Contracts as Buyer</a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="axil-mobile-toggle">
                                <button class="menu-btn mobile-nav-toggler">
                                    <i class="flaticon-menu-2"></i>
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Mainmenu Area -->
    </header>



<body>
    
    <h1>Deploy New Contract</h1>

    <div id="readArea">
        <br>

        <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
        <p id="accountArea"></p>

        <button onclick="createMyOwnContract()">CREATE MY OWN CONTRACT</button> <br>
        <p id="contractDeployValue"></p>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployPrice" placeholder="Enter the price of one item in USD"> <br>
        <br>
        <input style="visibility: hidden;" type="text" class="cool-input" id="deployQuant" placeholder="Enter the total quantity to sell"> <br>
        <br>
        <!-- <input style="visibility: hidden;" type="text" class="cool-input" id="deployValue"> <br> -->
        <button style="visibility: hidden" id = "deployValue" onclick="calculateDeployValue()" >CALCULATE FOR ME </button><br>
        <br>
        <p id="cost"></p>
        <p id="deployValueText"></p>
        <button style="visibility: hidden;" id="deployContract" onclick="deployContract()">DEPLOY CONTRACT</button> 
        <br>

        <p id="contractFollowMetamaskArea"></p>
        <p id="contractStartsDeployingArea"></p>
        <div id="myProgress">
            <div id="myBar">0%</div>
        </div>
        <p id="contractWaitingArea"></p>
        <p id="contractDeployStateArea"></p>
        <p id="contractAddressArea"></p>
        
        <p id="toContractDetail"></p>

        <button style="visibility: hidden;" id="addItem" onclick="location.href = 'sellerAddItemPage.html';">Add Item to My Contract</button>


    </div>

    <script>

        /* Ensure that the page starts at the top whenever refresh the page */
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        Parse.initialize("rgzBD2oDrFGwnP4GhepGqvLTb4zxUCVA8ISU94G6", "rbN8I2nlk462haH28HHxwAka3o02oVqWWz1PrFdi"); //PASTE HERE YOUR Back4App APPLICATION ID AND YOUR JavaScript KEY
        Parse.serverURL = "https://parseapi.back4app.com/";

        /* function that helps dynamically output text */

        function outputText(id, text) {

            var index = 0;
            var speed = 30;
            var container = document.getElementById(id);
            
            if (container.innerHTML !== "") {
                container.innerHTML = "";
            }

            var interval = setInterval(function() {
            if (index < text.length) {
                container.innerHTML += text.charAt(index);
                index++;
            } else {
                clearInterval(interval);
            }
            }, speed);
        }


        /* function that helps scroll down the html page*/
        function scrollToPosition(position, duration) {
        // Get the current scroll position
        var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        
        // Calculate the distance to scroll
        var distance = position - start;
        
        // Get the start time
        var startTime = null;
        
        function scroll(time) {
          if (startTime === null) {
            startTime = time;
          }
          
          var timeElapsed = time - startTime;
          var progress = Math.min(timeElapsed / duration, 1);
          var scrollTop = start + distance * easeInOutCubic(progress);
          window.scrollTo(0, scrollTop);
          
          if (timeElapsed < duration) {
            window.requestAnimationFrame(scroll);
          }
        }
        
        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }
        
        window.requestAnimationFrame(scroll);
        }
      
        function scrollDown() {
            var position = document.body.scrollHeight - window.innerHeight;
            var duration = 1700;
            scrollToPosition(position*0.2, duration);
        }
    


        let account;
        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];
                
                var text = `Hello Address: ${account}`;
                
                outputText("accountArea", text);

            }
            
        }


        const API_URL = "https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd";

        async function fetchETHPrice() {

            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                const ethPrice = data.ethereum.usd;
                console.log("Price of 1 ETH in USD:", ethPrice);
                return ethPrice;
            } catch (error) {
                console.error("Error fetching ETH price:", error);
            }
       }


        async function convertWeiToUSD(wei,  ethPrice) {
 
            const weiToEth = wei / 10**18;
            const weiToUSD = weiToEth * ethPrice;
            console.log(`${wei} Wei is worth ${weiToUSD} USD`);
            return weiToUSD;
        }

        async function convertUSDToWei(usd, ethPrice) {
            const usdToEth = usd / ethPrice;
           // const usdToWei = usdToEth * 10**18;
            console.log(`${usd} USD is worth ${usdToEth} Wei`);
            return usdToWei;
        }




        let quant;
        let price;
        const createMyOwnContract = async () => {


            var text = "Enter the price of one item and the total quantity you want to sell, we will calculate the total amount of escrow you need to depoly";

            outputText("contractDeployValue", text);
            
            scrollDown();

 
            document.getElementById("deployPrice").style.visibility = "visible";
            document.getElementById("deployQuant").style.visibility = "visible";
            


            document.getElementById("deployContract").style.visibility = "visible";
            document.getElementById("deployValue").style.visibility = "visible";


        }

        let cost;
        let deployedValue;
        let wei;
        const calculateDeployValue = async() => {

            quant = document.getElementById("deployQuant").value;
            price = document.getElementById("deployPrice").value;


            // USD -> WEI           
            const ethPrice = await fetchETHPrice();
            const usdToEth = price / ethPrice;
            const usdToWei = Math.ceil(usdToEth * 10**18);

            console.log("hi1", ethPrice);
            console.log("hi", usdToWei);

            var costUSD = quant*price;
            var deployedValueUSD = costUSD*2;

            wei = usdToWei;

                         //usdToWei
            cost = quant*usdToWei;
            deployedValue = cost * 2;

            // var text = `Total cost is ${cost} wei`;
            // var text2 = `Total deposit value is ${deployedValue} wei`;

            var text = `Total cost is $${costUSD} (${usdToEth*quant} ETH)`;
            var text2 = `Total deposit value required for escrow is $${deployedValueUSD} (${usdToEth*quant* 2} ETH)`;

            outputText("cost",text)
            outputText("deployValueText",text2);

        }

        async function pushSellerContract(sellerAddress, contractAddress) {

            const sellerContract = new Parse.Object("sellerContract");

            sellerContract.set("sellerAddress", sellerAddress);
            sellerContract.set("contractAddress", contractAddress);

            try {
                let result = await sellerContract.save();

            } catch (error) {
                alert(`Error: ${error.message}`);

            }
        } 
    

        let contractAddress;
        const deployContract = async () => {

            value = deployedValue;
            console.log(value);

            var text = "Please follow through the Metamask page ";
            
            outputText("contractFollowMetamaskArea", text);
            
            const ABI = [ { "inputs": [], "stateMutability": "payable", "type": "constructor" }, { "inputs": [], "name": "ActiveBuyer", "type": "error" }, { "inputs": [], "name": "AlreadyPurchased", "type": "error" }, { "inputs": [], "name": "ContractTerminated", "type": "error" }, { "inputs": [], "name": "ExceedMaxQuantity", "type": "error" }, { "inputs": [], "name": "InvalidAddress", "type": "error" }, { "inputs": [], "name": "InvalidState", "type": "error" }, { "inputs": [], "name": "ItemAddedAlready", "type": "error" }, { "inputs": [], "name": "ItemNotAdded", "type": "error" }, { "inputs": [], "name": "OnlyBuyer", "type": "error" }, { "inputs": [], "name": "OnlySeller", "type": "error" }, { "inputs": [], "name": "ValueNotEven", "type": "error" }, { "inputs": [], "name": "notEnoughEscrow", "type": "error" }, { "anonymous": false, "inputs": [], "name": "Added_item", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ConfirmShipped", "type": "event" }, { "anonymous": false, "inputs": [], "name": "ItemReceived", "type": "event" }, { "anonymous": false, "inputs": [], "name": "PurchaseConfirmed", "type": "event" }, { "anonymous": false, "inputs": [], "name": "SellerRefunded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "addedEscrow", "type": "event" }, { "anonymous": false, "inputs": [], "name": "closedContract", "type": "event" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "addEscrow", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "inp_value", "type": "uint256" }, { "internalType": "uint256", "name": "inp_quant", "type": "uint256" }, { "internalType": "string", "name": "inp_item_name", "type": "string" }, { "internalType": "string", "name": "inp_item_details", "type": "string" }, { "internalType": "string", "name": "inp_item_descriptions", "type": "string" } ], "name": "add_item", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "checkNoActiveBuyers", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "closeContract", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "uint256", "name": "quant", "type": "uint256" } ], "name": "confirmPurchase", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "confirmReceived", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "address_", "type": "address" } ], "name": "confirmShipped", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "key", "type": "address" } ], "name": "doesExist", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAddress", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBuyerNumber", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerQuantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "addr", "type": "address" } ], "name": "getBuyerState", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getEscrowLeft", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDescription", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemDetails", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemName", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getItemPriceInWEI", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getQuantity", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getReady", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getTerminated", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getTotalBuyer", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getValue", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "item_received_buyer", "type": "address" } ], "name": "refundSeller", "outputs": [], "stateMutability": "nonpayable", "type": "function" } ];

            const sellerAddress = account;
            var code = "0x6080604052600060025560006004556000600960006101000a81548160ff0219169083151502179055506000600960016101000a81548160ff02191690831515021790555033600960026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550346001819055506129f58061009b6000396000f3fe60806040526004361061014b5760003560e01c806361b53cdc116100b6578063abac1db71161006f578063abac1db714610425578063b905ebaa14610450578063c819d85a1461048d578063ddfab6a3146104b8578063f7fb44cd146104e1578063fd52c63f1461050c5761014b565b806361b53cdc1461034857806362a759071461037157806373fac6f01461038d5780637571ca36146103a45780637c81d123146103cf578063a0e9ec29146103fa5761014b565b80633341dfe6116101085780633341dfe61461026457806338cc4831146102a157806339e87889146102cc578063408b9945146102f75780634d24e90214610322578063610be6541461033e5761014b565b80630115949c1461015057806312065fe01461017b57806313b53c57146101a65780631a5c0730146101d157806320965255146101fc57806320c3839f14610227575b600080fd5b34801561015c57600080fd5b50610165610528565b6040516101729190611fc5565b60405180910390f35b34801561018757600080fd5b50610190610532565b60405161019d9190611fc5565b60405180910390f35b3480156101b257600080fd5b506101bb61053a565b6040516101c89190611fc5565b60405180910390f35b3480156101dd57600080fd5b506101e6610544565b6040516101f39190611ffb565b60405180910390f35b34801561020857600080fd5b50610211610561565b60405161021e9190611fc5565b60405180910390f35b34801561023357600080fd5b5061024e60048036038101906102499190612088565b61056a565b60405161025b9190611fc5565b60405180910390f35b34801561027057600080fd5b5061028b60048036038101906102869190612088565b6105f7565b6040516102989190611ffb565b60405180910390f35b3480156102ad57600080fd5b506102b66106a1565b6040516102c391906120c4565b60405180910390f35b3480156102d857600080fd5b506102e16106a9565b6040516102ee919061216f565b60405180910390f35b34801561030357600080fd5b5061030c61073b565b6040516103199190611fc5565b60405180910390f35b61033c600480360381019061033791906121bd565b610745565b005b610346610b09565b005b34801561035457600080fd5b5061036f600480360381019061036a9190612088565b610c80565b005b61038b60048036038101906103869190612088565b610f7b565b005b34801561039957600080fd5b506103a261114d565b005b3480156103b057600080fd5b506103b96113b4565b6040516103c69190611ffb565b60405180910390f35b3480156103db57600080fd5b506103e46113cb565b6040516103f1919061216f565b60405180910390f35b34801561040657600080fd5b5061040f61145d565b60405161041c919061216f565b60405180910390f35b34801561043157600080fd5b5061043a6114ef565b6040516104479190611ffb565b60405180910390f35b34801561045c57600080fd5b5061047760048036038101906104729190612088565b611506565b604051610484919061216f565b60405180910390f35b34801561049957600080fd5b506104a26116f3565b6040516104af919061216f565b60405180910390f35b3480156104c457600080fd5b506104df60048036038101906104da919061231f565b611785565b005b3480156104ed57600080fd5b506104f661190d565b6040516105039190611fc5565b60405180910390f35b610526600480360381019061052191906121bd565b611917565b005b6000600354905090565b600047905090565b6000600454905090565b6000806000905060006002540361055a57600190505b8091505090565b60008054905090565b600081610576816105f7565b6105ac576040517fe6c4247b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010154915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff16600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610697576001905061069c565b600090505b919050565b600030905090565b6060600880546106b89061241d565b80601f01602080910402602001604051908101604052809291908181526020018280546106e49061241d565b80156107315780601f1061070657610100808354040283529160200191610731565b820191906000526020600020905b81548152906001019060200180831161071457829003601f168201915b5050505050905090565b6000600254905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16036107cc576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff16610812576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6001600054600260015461082691906124ac565b61083091906124ac565b1015610868576040517ffa59aa5c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806003548111156108a5576040517f3435702900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff16156108ec576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b336108f6816105f7565b1561092d576040517f3367b55400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b82600054600261093d91906124dd565b61094791906124dd565b3414610988576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097f90612591565b60405180910390fd5b826003600082825461099a91906125b1565b92505081905550600260008154809291906109b4906125e5565b9190505550600460008154809291906109cc906125e5565b919050555060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff16815260200160006002811115610a0c57610a0b61262d565b5b815260200184815250600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff02191690836002811115610ac657610ac561262d565b5b0217905550604082015181600101559050507fd5d55c8a68912e9a110618df8d5e2e83b8d83211c57a8ddd1203df92885dc88160405160405180910390a1505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b90576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610b98610544565b610bce576040517fb3bf834d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6001600960006101000a81548160ff021916908315150217905550600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610c51573d6000803e3d6000fd5b507f76685d578223d8852db93c5274d5fcf6e1146fd0a64794bd61450d94e4a68db760405160405180910390a1565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610d07576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806002806002811115610d1d57610d1c61262d565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff166002811115610d7f57610d7e61262d565b5b14610db6576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7ffda69c32bcfdba840a167777906b173b607eb8b4d8853b97a80d26e613d858db60405160405180910390a160026000815480929190610df59061265c565b91905055506000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101549050600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc826000546003610e8d91906124dd565b610e9791906124dd565b9081150290604051600060405180830381858888f19350505050158015610ec2573d6000803e3d6000fd5b50806002600054610ed391906124dd565b610edd91906124dd565b600154610eea91906125b1565b600181905550600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690556000820160146101000a81549060ff02191690556001820160009055505050505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611002576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060008060028111156110185761101761262d565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600281111561107a5761107961262d565b5b146110b1576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe88a499366edd85624840c77defbb45744582b650f2424cbf1f787d8cde0af9060405160405180910390a16001600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff021916908360028111156111435761114261262d565b5b0217905550505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16036111d4576040517f86efbb5500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b3360018060028111156111ea576111e961262d565b5b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff16600281111561124c5761124b61262d565b5b14611283576040517fbaf3f0f700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7fe89152acd703c9d8c7d28829d443260b411454d45394e7995815140c8cbcbcf760405160405180910390a16002600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160146101000a81548160ff021916908360028111156113155761131461262d565b5b02179055503373ffffffffffffffffffffffffffffffffffffffff166108fc600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001015460005461138491906124dd565b9081150290604051600060405180830381858888f193505050501580156113af573d6000803e3d6000fd5b505050565b6000600960009054906101000a900460ff16905090565b6060600780546113da9061241d565b80601f01602080910402602001604051908101604052809291908181526020018280546114069061241d565b80156114535780601f1061142857610100808354040283529160200191611453565b820191906000526020600020905b81548152906001019060200180831161143657829003601f168201915b5050505050905090565b60606005805461146c9061241d565b80601f01602080910402602001604051908101604052809291908181526020018280546114989061241d565b80156114e55780601f106114ba576101008083540402835291602001916114e5565b820191906000526020600020905b8154815290600101906020018083116114c857829003601f168201915b5050505050905090565b6000600960019054906101000a900460ff16905090565b606081611512816105f7565b611548576040517fe6c4247b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160149054906101000a900460ff169050600060028111156115b0576115af61262d565b5b8160028111156115c3576115c261262d565b5b03611606576040518060400160405280600481526020017f70616964000000000000000000000000000000000000000000000000000000008152509250506116ed565b6001600281111561161a5761161961262d565b5b81600281111561162d5761162c61262d565b5b03611670576040518060400160405280600781526020017f73686970706564000000000000000000000000000000000000000000000000008152509250506116ed565b6002808111156116835761168261262d565b5b8160028111156116965761169561262d565b5b036116d9576040518060400160405280600881526020017f72656365697665640000000000000000000000000000000000000000000000008152509250506116ed565b604051806020016040528060008152509250505b50919050565b6060600680546117029061241d565b80601f016020809104026020016040519081016040528092919081815260200182805461172e9061241d565b801561177b5780601f106117505761010080835404028352916020019161177b565b820191906000526020600020905b81548152906001019060200180831161175e57829003601f168201915b5050505050905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461180c576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff1615611853576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff161561189a576040517f6a0dc1aa00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b7f2102e76fd7783eb09271c3b4224bde2fb0a69c21f25f974ad8f5f113fe71433760405160405180910390a16118d08585611aed565b6118d983611bbd565b6118e282611c57565b6118eb81611cf1565b6001600960016101000a81548160ff0219169083151502179055505050505050565b6000600154905090565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461199e576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960019054906101000a900460ff166119e4576040517f4330c19800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600960009054906101000a900460ff1615611a2b576040517f6d0d905800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806000546002611a3b91906124dd565b611a4591906124dd565b3414611a86576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a7d90612591565b60405180910390fd5b60008190508060036000828254611a9d9190612685565b925050819055503460016000828254611ab69190612685565b925050819055507f5b0ad5b6591b53a9520a0e0ca3d6293496d11bf227db2b819e7c0e0ab8500a7360405160405180910390a15050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611b74576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8160008190555080600381905550611b8b82611d8b565b604051602001611b9b919061271b565b60405160208183030381529060405260059081611bb891906128ed565b505050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611c44576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060069081611c5391906128ed565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611cde576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060079081611ced91906128ed565b5050565b600960029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611d78576040517f85d1f72600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060089081611d8791906128ed565b5050565b606060006001611d9a84611e59565b01905060008167ffffffffffffffff811115611db957611db86121f4565b5b6040519080825280601f01601f191660200182016040528015611deb5781602001600182028036833780820191505090505b509050600082602001820190505b600115611e4e578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a8581611e4257611e4161244e565b5b04945060008503611df9575b819350505050919050565b600080600090507a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008310611eb7577a184f03e93ff9f4daa797ed6e38ed64bf6a1f0100000000000000008381611ead57611eac61244e565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310611ef4576d04ee2d6d415b85acef81000000008381611eea57611ee961244e565b5b0492506020810190505b662386f26fc100008310611f2357662386f26fc100008381611f1957611f1861244e565b5b0492506010810190505b6305f5e1008310611f4c576305f5e1008381611f4257611f4161244e565b5b0492506008810190505b6127108310611f71576127108381611f6757611f6661244e565b5b0492506004810190505b60648310611f945760648381611f8a57611f8961244e565b5b0492506002810190505b600a8310611fa3576001810190505b80915050919050565b6000819050919050565b611fbf81611fac565b82525050565b6000602082019050611fda6000830184611fb6565b92915050565b60008115159050919050565b611ff581611fe0565b82525050565b60006020820190506120106000830184611fec565b92915050565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006120558261202a565b9050919050565b6120658161204a565b811461207057600080fd5b50565b6000813590506120828161205c565b92915050565b60006020828403121561209e5761209d612020565b5b60006120ac84828501612073565b91505092915050565b6120be8161204a565b82525050565b60006020820190506120d960008301846120b5565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156121195780820151818401526020810190506120fe565b60008484015250505050565b6000601f19601f8301169050919050565b6000612141826120df565b61214b81856120ea565b935061215b8185602086016120fb565b61216481612125565b840191505092915050565b600060208201905081810360008301526121898184612136565b905092915050565b61219a81611fac565b81146121a557600080fd5b50565b6000813590506121b781612191565b92915050565b6000602082840312156121d3576121d2612020565b5b60006121e1848285016121a8565b91505092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61222c82612125565b810181811067ffffffffffffffff8211171561224b5761224a6121f4565b5b80604052505050565b600061225e612016565b905061226a8282612223565b919050565b600067ffffffffffffffff82111561228a576122896121f4565b5b61229382612125565b9050602081019050919050565b82818337600083830152505050565b60006122c26122bd8461226f565b612254565b9050828152602081018484840111156122de576122dd6121ef565b5b6122e98482856122a0565b509392505050565b600082601f830112612306576123056121ea565b5b81356123168482602086016122af565b91505092915050565b600080600080600060a0868803121561233b5761233a612020565b5b6000612349888289016121a8565b955050602061235a888289016121a8565b945050604086013567ffffffffffffffff81111561237b5761237a612025565b5b612387888289016122f1565b935050606086013567ffffffffffffffff8111156123a8576123a7612025565b5b6123b4888289016122f1565b925050608086013567ffffffffffffffff8111156123d5576123d4612025565b5b6123e1888289016122f1565b9150509295509295909350565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061243557607f821691505b602082108103612448576124476123ee565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006124b782611fac565b91506124c283611fac565b9250826124d2576124d161244e565b5b828204905092915050565b60006124e882611fac565b91506124f383611fac565b925082820261250181611fac565b915082820484148315176125185761251761247d565b5b5092915050565b7f506c656173652073656e6420696e20327820746865207075726368617365206160008201527f6d6f756e74000000000000000000000000000000000000000000000000000000602082015250565b600061257b6025836120ea565b91506125868261251f565b604082019050919050565b600060208201905081810360008301526125aa8161256e565b9050919050565b60006125bc82611fac565b91506125c783611fac565b92508282039050818111156125df576125de61247d565b5b92915050565b60006125f082611fac565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036126225761262161247d565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b600061266782611fac565b91506000820361267a5761267961247d565b5b600182039050919050565b600061269082611fac565b915061269b83611fac565b92508282019050808211156126b3576126b261247d565b5b92915050565b600081905092915050565b60006126cf826120df565b6126d981856126b9565b93506126e98185602086016120fb565b80840191505092915050565b7f2057656900000000000000000000000000000000000000000000000000000000815250565b600061272782846126c4565b9150612732826126f5565b60048201915081905092915050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026127a37fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612766565b6127ad8683612766565b95508019841693508086168417925050509392505050565b6000819050919050565b60006127ea6127e56127e084611fac565b6127c5565b611fac565b9050919050565b6000819050919050565b612804836127cf565b612818612810826127f1565b848454612773565b825550505050565b600090565b61282d612820565b6128388184846127fb565b505050565b5b8181101561285c57612851600082612825565b60018101905061283e565b5050565b601f8211156128a15761287281612741565b61287b84612756565b8101602085101561288a578190505b61289e61289685612756565b83018261283d565b50505b505050565b600082821c905092915050565b60006128c4600019846008026128a6565b1980831691505092915050565b60006128dd83836128b3565b9150826002028217905092915050565b6128f6826120df565b67ffffffffffffffff81111561290f5761290e6121f4565b5b612919825461241d565b612924828285612860565b600060209050601f8311600181146129575760008415612945578287015190505b61294f85826128d1565b8655506129b7565b601f19841661296586612741565b60005b8281101561298d57848901518255600182019150602085019450602081019050612968565b868310156129aa57848901516129a6601f8916826128b3565b8355505b6001600288020188555050505b50505050505056fea26469706673582212204b89d4e9460cf8b7b0327439340e2c069b5ea8c2d28addbc4e5247fadca709bc64736f6c63430008110033";

            /*const Address = "0x182cc93685355256d9c782dcd8d5e5b43016277c";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address); */
            

            window.web3 = await new Web3(window.ethereum);
            

            window.web3.eth.sendTransaction({
                from: account,
                data: code,
                value: value
            }).on('transactionHash', async function (hash) {
                text = "Contract is now deploying, please wait";
                outputText("contractStartsDeployingArea", text);
                
                await move();

            }).on("receipt", async function (receipt) {
                if (receipt.status == false) {
                    text = "Contract-deploy fails, please check your Metamask page for more details";
                    outputText("contractDeployStateArea", text);
                } else {


                    await move_finish();

                    text = "Contract-deploy successful!";
                    outputText("contractDeployStateArea", text);

                    contractAddress = receipt.contractAddress;

                    text = "Here is your unique contract address: " + contractAddress;
                    outputText("contractAddressArea", text);

                    // store the contract address to the database
                    pushSellerContract(account, contractAddress); 
                    
                    // store the contract address and seller address to local storage and ensure the next page can access them
                    localStorage.setItem('contractAddress', contractAddress);
                    localStorage.setItem('sellerAddress', account);
                    localStorage.setItem('itemQuantity', quant);
                    localStorage.setItem('itemPrice', price);
                    localStorage.setItem('itemPriceWEI', wei);

                    console.log(localStorage.getItem("itemPrice"));
                    console.log(localStorage.getItem("itemQuantity"));


                    var button = document.getElementById("addItem");
                    button.style.visibility = "visible";
                    
                }
                
            });
            
            /* funtion of the moving bar */
            async function move() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 10;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 90) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.07;
                    elem.style.width = width + "%";
                    elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }   
                }
                
            }
            
            async function move_finish() {
                var text = document.getElementById("myProgress");
                var elem = document.getElementById("myBar");
                text.style.opacity = 1.0;
                elem.style.opacity = 1.0;
                
                i = 1;
                var width = 90;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width = width + 0.08;
                    if (width > 100) {
                        width = 100;
                        elem.style.width = width + "%";
                        elem.innerHTML = Number((width).toFixed(1))  + "%";
                    } else {
                        elem.style.width = width + "%";
                        elem.innerHTML = Number((width).toFixed(1))  + "%";
                    }
                }
                
            }
            
            async function pushSellerContract(sellerAddress, contractAddress) {

                const sellerContract = new Parse.Object("sellerContract");
   
                sellerContract.set("sellerAddress", sellerAddress);
                sellerContract.set("contractAddress", contractAddress);

                try {
                    let result = await sellerContract.save();

                } catch (error) {
                    alert(`Error: ${error.message}`);

                }
            } 
            
        }
    }

        

    </script>
     <!-- JS
============================================ -->
    <!-- Modernizer JS -->
    <script src="assets/js/vendor/modernizr.min.js"></script>
    <!-- jQuery JS -->
    <script src="assets/js/vendor/jquery.js"></script>
    <!-- Bootstrap JS -->
    <script src="assets/js/vendor/popper.min.js"></script>
    <script src="assets/js/vendor/bootstrap.min.js"></script>
    <script src="assets/js/vendor/slick.min.js"></script>
    <script src="assets/js/vendor/js.cookie.js"></script>
    <script src="assets/js/vendor/jquery-ui.min.js"></script>
    <script src="assets/js/vendor/jquery.countdown.min.js"></script>
    <script src="assets/js/vendor/sal.js"></script>
    <script src="assets/js/vendor/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/vendor/imagesloaded.pkgd.min.js"></script>
    <script src="assets/js/vendor/isotope.pkgd.min.js"></script>
    <script src="assets/js/vendor/counterup.js"></script>
    <script src="assets/js/vendor/waypoints.min.js"></script>

    <!-- Main JS -->
    <script src="assets/js/main.js"></script>

</body>

</html>